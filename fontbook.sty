\ProvidesPackage{fontbook}
\RequirePackage{fontspec}
\RequirePackage{xunicode}
\RequirePackage{kvoptions}
\RequirePackage{etoolbox}

\SetupKeyvalOptions{
   family=fontbook,
   prefix=fontbook@,
}

%% Options

% Sizes
\def\fontbook@allsizes{%
 huge, LARGE, Large, large, normalsize,
 small, footnotesize, scriptsize, tiny}
\expandafter\DeclareStringOption\expandafter[\fontbook@allsizes]{sizes}
\def\fontbook@allsizes{%
 huge, LARGE, Large, large, normalsize,
 small, footnotesize, scriptsize, tiny}

% Features
\def\fontbook@allfeatures{%
 scshape, itshape, bfseries}
\expandafter\DeclareStringOption\expandafter[\fontbook@allfeatures]{features}

\DeclareStringOption[large]{featuresize}

\ProcessKeyvalOptions*

\newcommand{\sampletext}[2][]{%
 {\par\csname#2\endcsname \csname#1\endcsname
 #2 #1\\
 Dans l'affliction éphémère qui m'accable, je teste
 la police d'affichage qui est affichée sur cette page 1 2 3 4 5.
 }
}

\newcommand{\samplefeature}[1]{%
 \sampletext[#1]{\fontbook@featuresize}}


\newcommand{\printfont}[3][\empty]{%
   \fontspec[#1]{#2}
   \section*{#2 #1 --- Licence: #3}
   \ifx#1\empty
     \addcontentsline{toc}{section}{#2}
   \else
     \addcontentsline{toc}{subsection}{#1}
   \fi

   \expandafter\forcsvlist\expandafter\sampletext\expandafter{\fontbook@sizes}
   \expandafter\forcsvlist\expandafter\samplefeature\expandafter{\fontbook@features}
   \pagebreak
}


